## Добавление в расширение проверки получения оригинала и добавление даты его получения

### Форма документа
```
&НаСервере
Процедура Расш_ПриСозданииНаСервереПеред(Отказ, СтандартнаяОбработка)
  ПрочитатьРегистрОригиналДатаПолучения(Объект.Ссылка);
  Если ОригиналПолучен Тогда
    Элементы.ДатаПолучения.Доступность = Истина;    
  Иначе       
    Элементы.ДатаПолучения.Доступность = Ложь;  
  КонецЕсли;  
КонецПроцедуры                   


&НаСервере
Процедура ПрочитатьРегистрОригиналДатаПолучения(ДокументСсылка)
  Запрос = Новый Запрос;
  Запрос.Текст = 
  "ВЫБРАТЬ
  | ОригиналДатаПолучения.ОригиналПолучен КАК ОригиналПолучен,
  | ОригиналДатаПолучения.ДатаПолучения КАК ДатаПолучения
  |ИЗ
  | РегистрСведений.ОригиналДатаПолучения КАК ОригиналДатаПолучения
  |ГДЕ
  | ОригиналДатаПолучения.Документ = &Документ";
  
  Запрос.УстановитьПараметр("Документ", ДокументСсылка);
  Выборка = Запрос.Выполнить().Выбрать();
  Выборка.Следующий();
  
  Если ЗначениеЗаполнено(Выборка) Тогда
    ОригиналПолучен = Выборка.ОригиналПолучен;
    ДатаПолучения = Выборка.ДатаПолучения;
  КонецЕсли;
КонецПроцедуры


&НаСервере
Процедура Расш_ОригиналПолученПриИзмененииПослеНаСервере(ОригиналПолучен)
    Если ОригиналПолучен Тогда  
    ДатаПолучения = ТекущаяДата();    
  Иначе       
    ДатаПолучения = Дата(1, 1, 1);  
  КонецЕсли;  
КонецПроцедуры

&НаКлиенте
Процедура Расш_ОригиналПолученПриИзмененииПосле(Элемент)
   Расш_ОригиналПолученПриИзмененииПослеНаСервере(ОригиналПолучен); 
  
  Если ОригиналПолучен Тогда  
    Элементы.ДатаПолучения.Доступность = Истина;
    Элементы.ДатаПолучения.ВыделенныйТекст = Формат(ТекущаяДата(), "ДФ=dd.MM.yyyy");
  Иначе       
    Элементы.ДатаПолучения.Доступность = Ложь;
  КонецЕсли;
  
  ЭтаФорма.Модифицированность = Истина;
КонецПроцедуры


&НаСервере
Процедура Расш_ПослеЗаписиНаСервереПосле(ТекущийОбъект, ПараметрыЗаписи)
  НаборЗаписей = РегистрыСведений.ОригиналДатаПолучения.СоздатьНаборЗаписей();
  НаборЗаписей.Отбор.Документ.Установить(ТекущийОбъект.Ссылка);
  НаборЗаписей.Прочитать();
  Если НаборЗаписей.Количество() > 0 Тогда 
    Если ДатаПолучения <> Дата(1, 1, 1) Тогда 
      Для каждого Запись Из НаборЗаписей Цикл
        Запись.ОригиналПолучен = ОригиналПолучен;
        Запись.ДатаПолучения = ДатаПолучения; 
        Запись.Период = ТекущаяДата();
        НаборЗаписей.Записать();   
      КонецЦикла;
      
    Иначе
      Сообщение = Новый СообщениеПользователю;
        Сообщение.Текст = "Дата не была заполнена";
        Сообщение.Поле = "ДатаПолучения";
        Сообщение.УстановитьДанные(Объект);
        Сообщение.Сообщить();
          
    КонецЕсли;
    
  Иначе
    НоваяЗапись = НаборЗаписей.Добавить();
    НоваяЗапись.Документ = ТекущийОбъект.Ссылка;
    НоваяЗапись.ОригиналПолучен = ОригиналПолучен;
    НоваяЗапись.ДатаПолучения = ДатаПолучения; 
    НоваяЗапись.Период = ТекущаяДата();
    НаборЗаписей.Записать();
    
  КонецЕсли;    
  
КонецПроцедуры

&НаКлиенте
Процедура Расш_ДатаПолученияПриИзмененииПосле(Элемент)
  ЭтаФорма.Модифицированность = Истина;
КонецПроцедуры
```


### Форма списка
```
&НаКлиенте
Процедура Расш_КомандаОригиналПолученПосле(Команда)
   Оповещение = Новый ОписаниеОповещения("ПослеВводаДаты", ЭтотОбъект);  
  ПоказатьВводДаты(Оповещение, , "Введите дату", ЧастиДаты.Дата);
КонецПроцедуры


&НаКлиенте
Процедура ПослеВводаДаты(Дата, Параметры) Экспорт
  Если Дата = Неопределено ИЛИ Дата = Дата(1, 1, 1) Тогда
    Сообщить("Дата не была введена");
  Иначе
    ВыделенныеСтроки = Элементы.Список.ВыделенныеСтроки;
    ИзменитьВыделенныеСтрокиВСоотвествииСДатой(ВыделенныеСтроки, Дата);
  КонецЕсли;
КонецПроцедуры


&НаСервере
Процедура ИзменитьВыделенныеСтрокиВСоотвествииСДатой(ВыделенныеСтроки, ДатаИзФормыВыбора)
  Для каждого Строка Из ВыделенныеСтроки Цикл
    НаборЗаписей = РегистрыСведений.ОригиналДатаПолучения.СоздатьНаборЗаписей();
    НаборЗаписей.Отбор.Документ.Установить(Строка);
    НаборЗаписей.Прочитать();
    Если НаборЗаписей.Количество() > 0 Тогда 
      Если ДатаИзФормыВыбора <> Неопределено Тогда 
        Для каждого Запись Из НаборЗаписей Цикл
          Запись.ОригиналПолучен = Истина;
          Запись.ДатаПолучения = ДатаИзФормыВыбора; 
          Запись.Период = ТекущаяДата();
          НаборЗаписей.Записать();  
        КонецЦикла;
      КонецЕсли;      
      
    Иначе
      НоваяЗапись = НаборЗаписей.Добавить();
      НоваяЗапись.Документ = Строка;
      НоваяЗапись.ОригиналПолучен = Истина;
      НоваяЗапись.ДатаПолучения = ДатаИзФормыВыбора; 
      НоваяЗапись.Период = ТекущаяДата();
      НаборЗаписей.Записать();
      
    КонецЕсли;
        
    Элементы.Список.Обновить();
  КонецЦикла;
КонецПроцедуры
```
